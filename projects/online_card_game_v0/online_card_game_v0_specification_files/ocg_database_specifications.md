---
Project: Online Card Game
Type: Specifications
Date: 2025-07-17
Spec-ID: SPEC-CG-DB
---

# Online Card Game V0 Database Specifications

## Overview
This document details the technical specifications for the database of the Online Card Game V0, corresponding to **SPEC-CG-DB** from **4.4.2 Online_Card_Game_Specifications_Overview.md**. The database stores game states, session data, and RAG embeddings, supporting requirements FR03 (game state persistence) and FR04 (session management). It is designed for solo development within a 20-hour/week schedule, hosted in LXC container `dockProd2` on Proxmox (16 GB RAM, NVMe storage) and mirrored on Linode, using PostgreSQL.

## Technical Specifications
- **Technology**: PostgreSQL.
- **Hosting**: LXC container `dockProd2` on Proxmox, mirrored on Linode for production.
- **Schema**:
  ```sql
  CREATE TABLE game_sessions (
      game_id VARCHAR(36) PRIMARY KEY,
      player_ids JSONB,  -- Array of player IDs
      game_state JSONB,  -- Current game state (cards, scores, etc.)
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      expires_at TIMESTAMP
  );
  CREATE TABLE game_logs (
      log_id SERIAL PRIMARY KEY,
      game_id VARCHAR(36),
      action TEXT,
      player_id VARCHAR(36),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (game_id) REFERENCES game_sessions(game_id)
  );
  CREATE TABLE rag_embeddings (
      document_id SERIAL PRIMARY KEY,
      document_path VARCHAR(255),
      embedding VECTOR(1536),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );
  ```
- **Features**:
  - Stores game states (cards, scores) with 24-hour expiry (FR03).
  - Logs player actions (e.g., draw, play) for analytics and recovery, supporting 100+ games per user (FR03).
  - Stores RAG embeddings for game logs and markdown documents, used by Ollama for challenge generation (FR02).
- **Security**: Encrypted connections via SSL, restricted access to FastAPI and Ollama.

## Implementation Details
- **Development**: Design schema in VS Code, apply via `psql` on Proxmox.
- **Testing**: Validate game state storage and RAG queries in `dockTest1` (Proxmox).
- **Deployment**: Deploy PostgreSQL in `dockProd2`, mirror to Linode via replication.
- **Dependencies**: Requires backend (SPEC-CG-BACK) for data input, AI-driven website for integration.
- **RAG Pipeline**: Embeddings generated by Ollama, stored in `rag_embeddings`, queried for challenges.
- **RAG Integration**: Store in `/docs/projects/online_card_game_specifications/`, sync to Linode, embed in PostgreSQL for RAG queries.